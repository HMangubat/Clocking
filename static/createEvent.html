<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Event Release Form</title>
  </head>
  <body>
    <div class="container">
      <h2>Release Event</h2>
      <label>Event Name: <input type="text" id="eventName" required /></label
      ><br />
      <label
        >Release Latitude (DMS):
        <input
          type="text"
          id="releaseLatDMS"
          placeholder="e.g. 12°36′15.47″ N"
          required /></label
      ><br />
      <label
        >Release Longitude (DMS):
        <input
          type="text"
          id="releaseLngDMS"
          placeholder="e.g. 123°45′30.25″ E"
          required /></label
      ><br />
      <button onclick="releaseEvent()">Submit</button>
      <p id="releaseResponse" style="display: none"></p>
    </div>

    <script>
      function releaseEvent() {
        const eventName = document.getElementById("eventName").value.trim();
        const releaseLatDMS = document
          .getElementById("releaseLatDMS")
          .value.trim();
        const releaseLngDMS = document
          .getElementById("releaseLngDMS")
          .value.trim();
        const responseEl = document.getElementById("releaseResponse");

        responseEl.style.display = "none";
        responseEl.textContent = "";

        fetch("/release", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ eventName, releaseLatDMS, releaseLngDMS }),
        })
          .then((res) => {
            if (!res.ok)
              return res.text().then((text) => {
                throw new Error(text);
              });
            return res.json();
          })
          .then((data) => {
            responseEl.style.display = "block";
            responseEl.style.color = "black";
            responseEl.textContent = `Success! Event ID: ${
              data.eventID
            }, Name: ${data.eventName}, Released at: ${new Date(
              data.releaseTime
            ).toLocaleString()}`;
            document.getElementById("eventName").value = "";
            document.getElementById("releaseLatDMS").value = "";
            document.getElementById("releaseLngDMS").value = "";
          })
          .catch((err) => {
            responseEl.style.display = "block";
            responseEl.style.color = "red";
            responseEl.textContent = "Error: " + err.message;
          });
      }
    </script>
  </body>
</html>
